---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getFeatureContentBySlug, getAllFeatureSlugs } from '../../lib/features-content';
import { getFeatureById, features } from '../../lib/features';
import { generateFAQSchema, generateServiceSchema } from '../../lib/structured-data';

// Générer toutes les pages de fonctionnalités au build
export async function getStaticPaths() {
  const slugs = getAllFeatureSlugs();
  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/fonctionnalites');
}

// Récupérer le contenu SEO
const content = getFeatureContentBySlug(slug);

// Récupérer les données de base de la fonctionnalité
const feature = getFeatureById(slug);

if (!content || !feature) {
  return Astro.redirect('/fonctionnalites');
}

const title = content.seoTitle;
const description = content.seoDescription;
const siteUrl = import.meta.env.PUBLIC_APP_URL || 'https://immotopia.com';
const canonicalUrl = `/fonctionnalites/${slug}`;

// Mapping des gradients par fonctionnalité
const getGradientForFeature = (featureId: string): string => {
  const gradientMap: Record<string, string> = {
    'gestion-biens': 'from-blue-500 to-cyan-500',
    'gestion-locative': 'from-indigo-500 to-purple-500',
    'syndic-copropriete': 'from-purple-500 to-pink-500',
    'crm-immobilier': 'from-emerald-500 to-teal-500',
    'promotion-immobiliere': 'from-orange-500 to-amber-500',
    'paiements-mobile-money': 'from-green-500 to-emerald-500',
    'automatisation-ia': 'from-violet-500 to-purple-500',
  };
  return gradientMap[featureId] || 'from-[#2563EB] to-[#1D4ED8]';
};

const gradient = getGradientForFeature(feature.id);

// Générer le schema FAQ
const faqSchema = content.faq.length > 0
  ? generateFAQSchema({
      questions: content.faq.map((item) => ({
        question: item.question,
        answer: item.answer,
      })),
    })
  : null;

// Générer le schema Service
const serviceSchema = generateServiceSchema({
  name: feature.name,
  description: content.seoDescription,
  provider: {
    '@type': 'Organization',
    name: 'ImmoTopia',
  },
  areaServed: 'Afrique de l\'Ouest',
  serviceType: 'Logiciel SaaS',
});

// Fonctionnalités connexes
const relatedFeatures = content.internalLinks.relatedFeatures
  ? features.filter((f) => content.internalLinks.relatedFeatures?.includes(f.id))
  : features.filter((f) => f.id !== feature.id).slice(0, 2);

// Structured data
const structuredData = [serviceSchema];
if (faqSchema) {
  structuredData.push(faqSchema);
}
---

<BaseLayout 
  title={title} 
  description={description} 
  currentPath={canonicalUrl}
  structuredData={structuredData}
>
  <div class="bg-white">
    {/* Breadcrumbs */}
    <div class="border-b border-gray-200 bg-gray-50 py-4">
      <div class="container mx-auto max-w-7xl px-6">
        <nav class="flex items-center gap-2 text-sm text-gray-600">
          <a href="/" class="hover:text-[#2563EB] transition-colors">Accueil</a>
          <span>/</span>
          <a href="/fonctionnalites" class="hover:text-[#2563EB] transition-colors">Fonctionnalités</a>
          <span>/</span>
          <span class="text-gray-900">{feature.name}</span>
        </nav>
      </div>
    </div>

    {/* Hero Section */}
    <section class="relative overflow-hidden bg-gradient-to-br from-[#F0F7FF] via-[#E8F2FF] to-[#D6EBFF] py-16 md:py-24">
      <div class="pointer-events-none absolute inset-0 overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_50%,rgba(37,99,235,0.12),transparent_50%)]" />
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_80%_80%,rgba(29,78,216,0.12),transparent_50%)]" />
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_20%,rgba(59,130,246,0.10),transparent_50%)]" />
        <div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]" />
      </div>

      <div class="container relative z-10 mx-auto max-w-4xl px-6">
        <div class="mb-6">
          <a 
            href="/fonctionnalites" 
            class="inline-flex items-center text-gray-600 hover:text-[#2563EB] transition-colors text-sm font-medium"
          >
            <svg class="mr-2 h-4 w-4 transition-transform duration-300 group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
            Retour aux fonctionnalités
          </a>
        </div>

        <div class="mb-6 inline-flex items-center gap-2 rounded-full border border-[#2563EB]/30 bg-white/80 backdrop-blur-md px-4 py-2 shadow-lg">
          <svg class="h-4 w-4 text-[#2563EB] animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg>
          <span class="text-xs font-bold uppercase tracking-wider text-[#2563EB]">
            Fonctionnalité
          </span>
        </div>

        <h1 class="mb-6 text-4xl font-extrabold leading-tight text-gray-900 md:text-5xl lg:text-6xl">
          {content.h1}
        </h1>

        <div class="space-y-4 text-lg leading-relaxed text-gray-700 md:text-xl">
          {content.intro.map((paragraph) => (
            <p>{paragraph}</p>
          ))}
        </div>
      </div>
    </section>

    {/* Benefits Section */}
    {content.benefits && content.benefits.length > 0 && (
      <section class="relative overflow-hidden bg-white py-16 md:py-24">
        <div class="pointer-events-none absolute inset-0">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(37,99,235,0.03),transparent_70%)]" />
        </div>

        <div class="container relative z-10 mx-auto max-w-6xl px-6">
          <div class="mb-12 text-center">
            <h2 class="mb-4 text-3xl font-bold text-gray-900 md:text-4xl">
              Bénéfices principaux
            </h2>
            <p class="mx-auto max-w-[600px] text-lg text-gray-600 md:text-xl">
              Découvrez les avantages concrets de cette fonctionnalité pour votre activité.
            </p>
          </div>

          <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
            {content.benefits.map((benefit) => (
              <div class="group rounded-lg border-2 border-transparent bg-white p-6 shadow-sm transition-all duration-300 hover:border-[#2563EB]/20 hover:shadow-xl hover:-translate-y-1">
                <div class={`mb-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-lg transition-all duration-300 group-hover:scale-110 bg-gradient-to-br ${gradient}`}>
                  <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <h3 class="mb-2 text-lg font-semibold text-gray-900">
                  {benefit.title}
                </h3>
                <p class="text-gray-700 leading-relaxed">{benefit.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    {/* Use Cases Section */}
    {content.useCases && content.useCases.length > 0 && (
      <section class="relative overflow-hidden bg-gray-50 py-16 md:py-24">
        <div class="container relative z-10 mx-auto max-w-6xl px-6">
          <div class="mb-12 text-center">
            <h2 class="mb-4 text-3xl font-bold text-gray-900 md:text-4xl">
              Cas d'usage concrets
            </h2>
            <p class="mx-auto max-w-[600px] text-lg text-gray-600 md:text-xl">
              Découvrez comment cette fonctionnalité transforme l'activité de professionnels comme vous.
            </p>
          </div>

          <div class="space-y-6">
            {content.useCases.map((useCase) => (
              <div class="rounded-lg border-2 border-gray-200 bg-white p-6 shadow-sm transition-all duration-300 hover:border-[#2563EB]/30 hover:shadow-lg md:p-8">
                <div class="mb-3 inline-flex items-center gap-2 rounded-full bg-[#2563EB]/10 px-3 py-1">
                  <svg class="h-4 w-4 text-[#2563EB]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                  <span class="text-xs font-semibold text-[#2563EB]">{useCase.persona}</span>
                </div>
                <h3 class="mb-3 text-xl font-bold text-gray-900">{useCase.title}</h3>
                <p class="text-gray-700 leading-relaxed">{useCase.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    {/* Personas Section */}
    {content.personas && content.personas.length > 0 && (
      <section class="relative overflow-hidden bg-white py-16 md:py-24">
        <div class="container relative z-10 mx-auto max-w-6xl px-6">
          <div class="mb-12 text-center">
            <div class="mb-4 inline-flex items-center gap-2 rounded-full border border-[#2563EB]/30 bg-white/80 backdrop-blur-md px-4 py-2 shadow-lg">
              <svg class="h-4 w-4 text-[#2563EB]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span class="text-xs font-bold uppercase tracking-wider text-[#2563EB]">
                Idéal pour
              </span>
            </div>
            <h2 class="mb-4 text-3xl font-bold text-gray-900 md:text-4xl">
              Pour qui ?
            </h2>
            <p class="mx-auto max-w-[600px] text-lg text-gray-600 md:text-xl">
              Cette fonctionnalité est particulièrement adaptée aux besoins de :
            </p>
          </div>

          <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
            {content.personas.map((persona) => (
              <div class="h-full rounded-lg border-2 border-transparent bg-white p-6 shadow-sm transition-all duration-300 hover:border-[#2563EB]/30 hover:shadow-lg hover:-translate-y-1">
                <div class={`mb-4 flex h-12 w-12 items-center justify-center rounded-lg transition-all duration-300 bg-gradient-to-br ${gradient}`}>
                  <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
                <h3 class="mb-2 text-lg font-semibold text-gray-900">{persona.name}</h3>
                <p class="text-gray-700 leading-relaxed">{persona.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    {/* FAQ Section */}
    {content.faq && content.faq.length > 0 && (
      <section class="relative overflow-hidden bg-gray-50 py-16 md:py-24">
        <div class="container relative z-10 mx-auto max-w-4xl px-6">
          <div class="mb-12 text-center">
            <div class="mb-4 inline-flex items-center gap-2 rounded-full border border-[#2563EB]/30 bg-white/80 backdrop-blur-md px-4 py-2 shadow-lg">
              <svg class="h-4 w-4 text-[#2563EB]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs font-bold uppercase tracking-wider text-[#2563EB]">
                Questions fréquentes
              </span>
            </div>
            <h2 class="mb-4 text-3xl font-bold text-gray-900 md:text-4xl">
              Questions fréquentes
            </h2>
          </div>

          <div class="space-y-4">
            {content.faq.map((item) => (
              <div class="rounded-lg border-2 border-gray-200 bg-white p-6 shadow-sm">
                <h3 class="mb-3 text-lg font-semibold text-gray-900">{item.question}</h3>
                <p class="text-gray-700 leading-relaxed">{item.answer}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    {/* Related Features Section */}
    {relatedFeatures.length > 0 && (
      <section class="relative overflow-hidden bg-white py-16 md:py-24">
        <div class="container relative z-10 mx-auto max-w-6xl px-6">
          <div class="mb-12 text-center">
            <h2 class="mb-4 text-3xl font-bold text-gray-900 md:text-4xl">
              Fonctionnalités connexes
            </h2>
            <p class="mx-auto max-w-[600px] text-lg text-gray-600 md:text-xl">
              Découvrez d'autres fonctionnalités qui pourraient vous intéresser.
            </p>
          </div>

          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {relatedFeatures.map((relatedFeature) => (
              <a
                href={relatedFeature.slug}
                class="group block no-underline"
              >
                <div class="flex items-start gap-4 rounded-lg border border-gray-200 bg-white p-4 transition-all duration-300 hover:border-[#2563EB]/30 hover:shadow-md">
                  <div class="mt-1 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-[#2563EB]/10 text-[#2563EB] transition-colors duration-300 group-hover:bg-[#2563EB]/20">
                    <span class="text-lg font-semibold">{relatedFeature.name.charAt(0)}</span>
                  </div>
                  <div class="flex-1">
                    <h3 class="mb-1 text-base font-semibold text-gray-900 transition-colors duration-300 group-hover:text-[#2563EB]">
                      {relatedFeature.name}
                    </h3>
                    <p class="mb-2 text-sm leading-relaxed text-gray-600">
                      {relatedFeature.description}
                    </p>
                    <div class="flex items-center text-xs font-medium text-[#2563EB] transition-all duration-300 group-hover:gap-1">
                      Découvrir en détail
                      <svg class="ml-1 h-3 w-3 transition-transform duration-300 group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    {/* CTA Section */}
    <section class="relative overflow-hidden bg-gradient-to-br from-[#2563EB] via-indigo-600 to-[#1D4ED8] py-16 text-white md:py-24">
      <div class="pointer-events-none absolute inset-0">
        <div class="absolute top-0 left-1/4 h-96 w-96 rounded-full bg-white/10 blur-3xl animate-pulse" />
        <div class="absolute bottom-0 right-1/4 h-96 w-96 rounded-full bg-white/10 blur-3xl animate-pulse" style="animation-delay: 1s" />
      </div>

      <div class="container relative z-10 mx-auto max-w-4xl px-6 text-center">
        <h2 class="mb-6 text-3xl font-bold md:text-4xl lg:text-5xl">
          Prêt à découvrir {feature.name} ?
        </h2>

        <p class="mb-8 text-lg text-white/90 md:text-xl">
          Demandez une démonstration personnalisée et découvrez comment cette fonctionnalité peut transformer votre activité.
        </p>

        <div class="flex flex-col items-center justify-center gap-4 sm:flex-row">
          <a
            href={content.internalLinks.contact || '/contact?demo=true'}
            class="group flex items-center font-bold bg-white text-[#2563EB] px-6 py-3 rounded-lg shadow-xl transition-all duration-300 hover:bg-gray-100 hover:shadow-2xl"
          >
            Demander une démo
            <svg class="ml-2 h-4 w-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </a>
          {content.internalLinks.pricing && (
            <a
              href={content.internalLinks.pricing}
              class="font-semibold border-2 border-white/30 bg-white/10 backdrop-blur-sm text-white px-6 py-3 rounded-lg transition-all duration-300 hover:border-white/50 hover:bg-white/20"
            >
              Voir les tarifs
            </a>
          )}
          <a
            href="/contact?signup=true"
            class="font-semibold border-2 border-white/30 bg-white/10 backdrop-blur-sm text-white px-6 py-3 rounded-lg transition-all duration-300 hover:border-white/50 hover:bg-white/20"
          >
            Créer mon compte
          </a>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>

